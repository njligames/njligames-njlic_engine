include(${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/cmake/macros.cmake)

list(APPEND CMAKE_MODULE_PATH "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/cmake")

find_package(SWIG REQUIRED)

#   SWIG_FOUND - set to true if SWIG is found
#   SWIG_DIR - the directory where swig is installed
#   SWIG_EXECUTABLE - the path to the swig executable
#   SWIG_VERSION   - the version number of the swig executable
MESSAGE(STATUS "SWIG_FOUND ${SWIG_FOUND}")
MESSAGE(STATUS "SWIG_DIR ${SWIG_DIR}")
MESSAGE(STATUS "SWIG_EXECUTABLE ${SWIG_EXECUTABLE}")
MESSAGE(STATUS "SWIG_VERSION ${SWIG_VERSION}")

# General source files
file(GLOB_RECURSE SOURCE_FILES
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/*.c
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/*.cpp
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/*.cxx
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/*.m
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/*.mm

  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/*.c
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/*.cpp
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/*.cxx
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/*.m
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/*.mm

  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/*.c
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/*.cpp
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/*.cxx
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/*.m
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/*.mm
  )

file(GLOB MAIN_FILES
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/platform/main.cpp
  )

file(GLOB_RECURSE INCLUDE_FILES
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/*.h
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/*.hpp
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/*.hxx

  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/bullet/*.h
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/bullet/*.hpp
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/bullet/*.hxx

  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/sdl2_test/*.h
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/sdl2_test/*.hpp
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/sdl2_test/*.hxx
  
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/*.h
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/*.hpp
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/*.hxx
  
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/*.h
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/*.hpp
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/*.hxx
  
  )

SUBDIRLIST(SUBDIRS "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli" NJLI_INCLUDE_DIRECTORY_LIST)
SUBDIRLIST(SUBDIRS "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/bullet" BULLET_INCLUDE_DIRECTORY_LIST)
SUBDIRLIST(SUBDIRS "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/sdl2_test" SDL2_INCLUDE_DIRECTORY_LIST)
SUBDIRLIST(SUBDIRS "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src" LUA_SRC_INCLUDE_DIRECTORY_LIST)
SUBDIRLIST(SUBDIRS "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts" LUA_EXTS_INCLUDE_DIRECTORY_LIST)

set(${CMAKE_PROJECT_NAME}_SOUND_PLATFORM "openal" CACHE STRING "The rendering platform to use")
set(${CMAKE_PROJECT_NAME}_SOUND_PLATFORM_Values "openal;fmod;sdl")

if(EMSCRIPTEN)
  # REMOVE_PLATFORM_FILES("emscripten")
  REMOVE_PLATFORM_FILES("windows")
  REMOVE_PLATFORM_FILES("ios")
  REMOVE_PLATFORM_FILES("appletv")
  REMOVE_PLATFORM_FILES("macOS")
  REMOVE_PLATFORM_FILES("linux")
  REMOVE_PLATFORM_FILES("unix")
  REMOVE_PLATFORM_FILES("android")
  REMOVE_PLATFORM_FILES("applewatchos")
  set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM "opengl_es_2" CACHE STRING "The rendering platform to use")
  set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM_Values "opengl_es_2;opengl_es_3")
elseif(WINDOWS)
  REMOVE_PLATFORM_FILES("emscripten")
  # REMOVE_PLATFORM_FILES("windows")
  REMOVE_PLATFORM_FILES("ios")
  REMOVE_PLATFORM_FILES("appletv")
  REMOVE_PLATFORM_FILES("macOS")
  REMOVE_PLATFORM_FILES("linux")
  REMOVE_PLATFORM_FILES("unix")
  REMOVE_PLATFORM_FILES("android")
  REMOVE_PLATFORM_FILES("applewatchos")
  set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM "opengl_2" CACHE STRING "The rendering platform to use")
  set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM_Values "opengl_2;opengl_3")
elseif(APPLE)
  if(IOS)
    REMOVE_PLATFORM_FILES("emscripten")
    REMOVE_PLATFORM_FILES("windows")
    # REMOVE_PLATFORM_FILES("ios")
    REMOVE_PLATFORM_FILES("appletv")
    REMOVE_PLATFORM_FILES("macOS")
    REMOVE_PLATFORM_FILES("linux")
    REMOVE_PLATFORM_FILES("unix")
    REMOVE_PLATFORM_FILES("android")
    REMOVE_PLATFORM_FILES("applewatchos")
    set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM "opengl_es_2" CACHE STRING "The rendering platform to use")
    set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM_Values "opengl_es_2;opengl_es_3")
  elseif(TVOS)
    REMOVE_PLATFORM_FILES("emscripten")
    REMOVE_PLATFORM_FILES("windows")
    REMOVE_PLATFORM_FILES("ios")
    # REMOVE_PLATFORM_FILES("appletv")
    REMOVE_PLATFORM_FILES("macOS")
    REMOVE_PLATFORM_FILES("linux")
    REMOVE_PLATFORM_FILES("unix")
    REMOVE_PLATFORM_FILES("android")
    REMOVE_PLATFORM_FILES("applewatchos")
    set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM "opengl_es_2" CACHE STRING "The rendering platform to use")
    set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM_Values "opengl_es_2;opengl_es_3")
  else()
    REMOVE_PLATFORM_FILES("emscripten")
    REMOVE_PLATFORM_FILES("windows")
    REMOVE_PLATFORM_FILES("ios")
    REMOVE_PLATFORM_FILES("appletv")
    # REMOVE_PLATFORM_FILES("macOS")
    REMOVE_PLATFORM_FILES("linux")
    REMOVE_PLATFORM_FILES("unix")
    REMOVE_PLATFORM_FILES("android")
    REMOVE_PLATFORM_FILES("applewatchos")
    set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM "opengl_2" CACHE STRING "The rendering platform to use")
    set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM_Values "opengl_2;opengl_3")
  endif()
elseif(UNIX AND NOT APPLE AND NOT ANDROID)
  if(LINUX)
    REMOVE_PLATFORM_FILES("emscripten")
    REMOVE_PLATFORM_FILES("windows")
    REMOVE_PLATFORM_FILES("ios")
    REMOVE_PLATFORM_FILES("appletv")
    REMOVE_PLATFORM_FILES("macOS")
    # REMOVE_PLATFORM_FILES("linux")
    REMOVE_PLATFORM_FILES("unix")
    REMOVE_PLATFORM_FILES("android")
    REMOVE_PLATFORM_FILES("applewatchos")
    set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM "opengl_2" CACHE STRING "The rendering platform to use")
    set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM_Values "opengl_2;opengl_3")
  elseif(UNIX)
    REMOVE_PLATFORM_FILES("emscripten")
    REMOVE_PLATFORM_FILES("windows")
    REMOVE_PLATFORM_FILES("ios")
    REMOVE_PLATFORM_FILES("appletv")
    REMOVE_PLATFORM_FILES("macOS")
    REMOVE_PLATFORM_FILES("linux")
    # REMOVE_PLATFORM_FILES("unix")
    REMOVE_PLATFORM_FILES("android")
    REMOVE_PLATFORM_FILES("applewatchos")
    set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM "opengl_2" CACHE STRING "The rendering platform to use")
    set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM_Values "opengl_2;opengl_3")
  endif()
elseif(ANDROID)
  REMOVE_PLATFORM_FILES("emscripten")
  REMOVE_PLATFORM_FILES("windows")
  REMOVE_PLATFORM_FILES("ios")
  REMOVE_PLATFORM_FILES("appletv")
  REMOVE_PLATFORM_FILES("macOS")
  REMOVE_PLATFORM_FILES("linux")
  REMOVE_PLATFORM_FILES("unix")
  # REMOVE_PLATFORM_FILES("android")
  REMOVE_PLATFORM_FILES("applewatchos")
  set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM "opengl_es_2" CACHE STRING "The rendering platform to use")
  set(${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM_Values "opengl_es_2;opengl_es_3")
endif()

set_property(CACHE ${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM PROPERTY STRINGS ${${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM_Values})

IF( ${${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM} STREQUAL "opengl_es_2" )
  ADD_DEFINITIONS(-D__GL_ES2__)
ELSEIF( ${${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM} STREQUAL "opengl_es_3" )
  ADD_DEFINITIONS(-D__GL_ES3__)
ELSEIF( ${${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM} STREQUAL "opengl_2" )
  ADD_DEFINITIONS(-D__GL_2__)
ELSEIF( ${${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM} STREQUAL "opengl_3" )
  ADD_DEFINITIONS(-D__GL_3__)
ENDIF()

set_property(CACHE ${CMAKE_PROJECT_NAME}_SOUND_PLATFORM PROPERTY STRINGS ${${CMAKE_PROJECT_NAME}_SOUND_PLATFORM_Values})

IF( ${${CMAKE_PROJECT_NAME}_SOUND_PLATFORM} STREQUAL "fmod" )
  ADD_DEFINITIONS(-D__FMOD__)
ELSEIF( ${${CMAKE_PROJECT_NAME}_SOUND_PLATFORM} STREQUAL "openal" )
  ADD_DEFINITIONS(-D__OPENAL__)
ELSEIF( ${${CMAKE_PROJECT_NAME}_SOUND_PLATFORM} STREQUAL "sdl" )
  ADD_DEFINITIONS(-D__SDL__)
ENDIF()

IF( NOT ${${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM} STREQUAL "opengl_es_2" )
  file(GLOB_RECURSE GL_ES_2_SOURCE_FILES
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_es_2/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_es_2/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_es_2/*.cxx

    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_es_2/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_es_2/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_es_2/*.cxx
    )

  list(REMOVE_ITEM SOURCE_FILES ${GL_ES_2_SOURCE_FILES})
ENDIF()

IF( NOT ${${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM} STREQUAL "opengl_es_3" )
  file(GLOB_RECURSE GL_ES_3_SOURCE_FILES
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_es_3/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_es_3/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_es_3/*.cxx

    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_es_3/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_es_3/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_es_3/*.cxx
    )

  list(REMOVE_ITEM SOURCE_FILES ${GL_ES_3_SOURCE_FILES})
ENDIF()

IF( NOT ${${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM} STREQUAL "opengl_2" )
  file(GLOB_RECURSE GL_2_SOURCE_FILES
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_2/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_2/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_2/*.cxx

    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_2/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_2/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_2/*.cxx
    )

  list(REMOVE_ITEM SOURCE_FILES ${GL_2_SOURCE_FILES})
ENDIF()

IF( NOT ${${CMAKE_PROJECT_NAME}_GRAPHICS_PLATFORM} STREQUAL "opengl_3" )
  file(GLOB_RECURSE GL_3_SOURCE_FILES
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_3/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_3/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/graphics/opengl_3/*.cxx

    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_3/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_3/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/generated/swig/lua/opengl_3/*.cxx
    )

  list(REMOVE_ITEM SOURCE_FILES ${GL_3_SOURCE_FILES})
ENDIF()

IF( NOT ${${CMAKE_PROJECT_NAME}_SOUND_PLATFORM} STREQUAL "fmod" )
  file(GLOB_RECURSE FMOD_SOURCE_FILES
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/sound/fmod/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/sound/fmod/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/sound/fmod/*.cxx
    )

  list(REMOVE_ITEM SOURCE_FILES ${FMOD_SOURCE_FILES})
ENDIF()

IF( NOT ${${CMAKE_PROJECT_NAME}_SOUND_PLATFORM} STREQUAL "openal" )
  file(GLOB_RECURSE OPENAL_SOURCE_FILES
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/sound/openal/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/sound/openal/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/sound/openal/*.cxx
    )

  list(REMOVE_ITEM SOURCE_FILES ${OPENAL_SOURCE_FILES})
ENDIF()

IF( NOT ${${CMAKE_PROJECT_NAME}_SOUND_PLATFORM} STREQUAL "sdl" )
  file(GLOB_RECURSE SDL_SOURCE_FILES
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/sound/sdl/*.c
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/sound/sdl/*.cpp
    ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli/sound/sdl/*.cxx
    )

  list(REMOVE_ITEM SOURCE_FILES ${SDL_SOURCE_FILES})
ENDIF()

LIST(REMOVE_ITEM INCLUDE_FILES
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/luasocket/compat.h"
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/luasocket/wsocket.h"
  )

LIST(REMOVE_ITEM SOURCE_FILES
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/luasocket/compat.c"
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts/luasocket/wsocket.c"
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/loadlib_rel.c"
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/lua.c"
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/lua.rc"
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/luac.c"
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/luac.rc"
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/luaconf.h.in"
  "${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src/wmain.c"
)

# MUST BE AT THE END
# General includes
include_directories(
  ${${CMAKE_PROJECT_NAME}_BINARY_DIR}/include 
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/njli ${NJLI_INCLUDE_DIRECTORY_LIST} 
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/bullet ${BULLET_INCLUDE_DIRECTORY_LIST} 
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/sdl2_test ${SDL2_INCLUDE_DIRECTORY_LIST}
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/src ${LUA_SRC_INCLUDE_DIRECTORY_LIST}
  ${${CMAKE_PROJECT_NAME}_REPO_DIRECTORY}/lua/exts ${LUA_EXTS_INCLUDE_DIRECTORY_LIST}
  )

